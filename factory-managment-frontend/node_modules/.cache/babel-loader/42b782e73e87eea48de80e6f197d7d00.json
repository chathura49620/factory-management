{"ast":null,"code":"import { ascending, min, sum } from \"d3-array\";\nimport { map, nest } from \"d3-collection\";\nimport { justify } from \"./align\";\nimport constant from \"./constant\";\n\nfunction ascendingSourceBreadth(a, b) {\n  return ascendingBreadth(a.source, b.source) || a.index - b.index;\n}\n\nfunction ascendingTargetBreadth(a, b) {\n  return ascendingBreadth(a.target, b.target) || a.index - b.index;\n}\n\nfunction ascendingBreadth(a, b) {\n  return a.y0 - b.y0;\n}\n\nfunction value(d) {\n  return d.value;\n}\n\nfunction nodeCenter(node) {\n  return (node.y0 + node.y1) / 2;\n}\n\nfunction weightedSource(link) {\n  return nodeCenter(link.source) * link.value;\n}\n\nfunction weightedTarget(link) {\n  return nodeCenter(link.target) * link.value;\n}\n\nfunction defaultId(d) {\n  return d.index;\n}\n\nfunction defaultNodes(graph) {\n  return graph.nodes;\n}\n\nfunction defaultLinks(graph) {\n  return graph.links;\n}\n\nfunction find(nodeById, id) {\n  var node = nodeById.get(id);\n  if (!node) throw new Error(\"missing: \" + id);\n  return node;\n}\n\nexport default function () {\n  var x0 = 0,\n      y0 = 0,\n      x1 = 1,\n      y1 = 1,\n      // extent\n  dx = 24,\n      // nodeWidth\n  py = 8,\n      // nodePadding\n  id = defaultId,\n      align = justify,\n      nodes = defaultNodes,\n      links = defaultLinks,\n      iterations = 32;\n\n  function sankey() {\n    var graph = {\n      nodes: nodes.apply(null, arguments),\n      links: links.apply(null, arguments)\n    };\n    computeNodeLinks(graph);\n    computeNodeValues(graph);\n    computeNodeDepths(graph);\n    computeNodeBreadths(graph, iterations);\n    computeLinkBreadths(graph);\n    return graph;\n  }\n\n  sankey.update = function (graph) {\n    computeLinkBreadths(graph);\n    return graph;\n  };\n\n  sankey.nodeId = function (_) {\n    return arguments.length ? (id = typeof _ === \"function\" ? _ : constant(_), sankey) : id;\n  };\n\n  sankey.nodeAlign = function (_) {\n    return arguments.length ? (align = typeof _ === \"function\" ? _ : constant(_), sankey) : align;\n  };\n\n  sankey.nodeWidth = function (_) {\n    return arguments.length ? (dx = +_, sankey) : dx;\n  };\n\n  sankey.nodePadding = function (_) {\n    return arguments.length ? (py = +_, sankey) : py;\n  };\n\n  sankey.nodes = function (_) {\n    return arguments.length ? (nodes = typeof _ === \"function\" ? _ : constant(_), sankey) : nodes;\n  };\n\n  sankey.links = function (_) {\n    return arguments.length ? (links = typeof _ === \"function\" ? _ : constant(_), sankey) : links;\n  };\n\n  sankey.size = function (_) {\n    return arguments.length ? (x0 = y0 = 0, x1 = +_[0], y1 = +_[1], sankey) : [x1 - x0, y1 - y0];\n  };\n\n  sankey.extent = function (_) {\n    return arguments.length ? (x0 = +_[0][0], x1 = +_[1][0], y0 = +_[0][1], y1 = +_[1][1], sankey) : [[x0, y0], [x1, y1]];\n  };\n\n  sankey.iterations = function (_) {\n    return arguments.length ? (iterations = +_, sankey) : iterations;\n  }; // Populate the sourceLinks and targetLinks for each node.\n  // Also, if the source and target are not objects, assume they are indices.\n\n\n  function computeNodeLinks(graph) {\n    graph.nodes.forEach(function (node, i) {\n      node.index = i;\n      node.sourceLinks = [];\n      node.targetLinks = [];\n    });\n    var nodeById = map(graph.nodes, id);\n    graph.links.forEach(function (link, i) {\n      link.index = i;\n      var source = link.source,\n          target = link.target;\n      if (typeof source !== \"object\") source = link.source = find(nodeById, source);\n      if (typeof target !== \"object\") target = link.target = find(nodeById, target);\n      source.sourceLinks.push(link);\n      target.targetLinks.push(link);\n    });\n  } // Compute the value (size) of each node by summing the associated links.\n\n\n  function computeNodeValues(graph) {\n    graph.nodes.forEach(function (node) {\n      node.value = Math.max(sum(node.sourceLinks, value), sum(node.targetLinks, value));\n    });\n  } // Iteratively assign the depth (x-position) for each node.\n  // Nodes are assigned the maximum depth of incoming neighbors plus one;\n  // nodes with no incoming links are assigned depth zero, while\n  // nodes with no outgoing links are assigned the maximum depth.\n\n\n  function computeNodeDepths(graph) {\n    var nodes, next, x;\n\n    for (nodes = graph.nodes, next = [], x = 0; nodes.length; ++x, nodes = next, next = []) {\n      nodes.forEach(function (node) {\n        node.depth = x;\n        node.sourceLinks.forEach(function (link) {\n          if (next.indexOf(link.target) < 0) {\n            next.push(link.target);\n          }\n        });\n      });\n    }\n\n    for (nodes = graph.nodes, next = [], x = 0; nodes.length; ++x, nodes = next, next = []) {\n      nodes.forEach(function (node) {\n        node.height = x;\n        node.targetLinks.forEach(function (link) {\n          if (next.indexOf(link.source) < 0) {\n            next.push(link.source);\n          }\n        });\n      });\n    }\n\n    var kx = (x1 - x0 - dx) / (x - 1);\n    graph.nodes.forEach(function (node) {\n      node.x1 = (node.x0 = x0 + Math.max(0, Math.min(x - 1, Math.floor(align.call(null, node, x)))) * kx) + dx;\n    });\n  }\n\n  function computeNodeBreadths(graph) {\n    var columns = nest().key(function (d) {\n      return d.x0;\n    }).sortKeys(ascending).entries(graph.nodes).map(function (d) {\n      return d.values;\n    }); //\n\n    initializeNodeBreadth();\n    resolveCollisions();\n\n    for (var alpha = 1, n = iterations; n > 0; --n) {\n      relaxRightToLeft(alpha *= 0.99);\n      resolveCollisions();\n      relaxLeftToRight(alpha);\n      resolveCollisions();\n    }\n\n    function initializeNodeBreadth() {\n      var ky = min(columns, function (nodes) {\n        return (y1 - y0 - (nodes.length - 1) * py) / sum(nodes, value);\n      });\n      columns.forEach(function (nodes) {\n        nodes.forEach(function (node, i) {\n          node.y1 = (node.y0 = i) + node.value * ky;\n        });\n      });\n      graph.links.forEach(function (link) {\n        link.width = link.value * ky;\n      });\n    }\n\n    function relaxLeftToRight(alpha) {\n      columns.forEach(function (nodes) {\n        nodes.forEach(function (node) {\n          if (node.targetLinks.length) {\n            var dy = (sum(node.targetLinks, weightedSource) / sum(node.targetLinks, value) - nodeCenter(node)) * alpha;\n            node.y0 += dy, node.y1 += dy;\n          }\n        });\n      });\n    }\n\n    function relaxRightToLeft(alpha) {\n      columns.slice().reverse().forEach(function (nodes) {\n        nodes.forEach(function (node) {\n          if (node.sourceLinks.length) {\n            var dy = (sum(node.sourceLinks, weightedTarget) / sum(node.sourceLinks, value) - nodeCenter(node)) * alpha;\n            node.y0 += dy, node.y1 += dy;\n          }\n        });\n      });\n    }\n\n    function resolveCollisions() {\n      columns.forEach(function (nodes) {\n        var node,\n            dy,\n            y = y0,\n            n = nodes.length,\n            i; // Push any overlapping nodes down.\n\n        nodes.sort(ascendingBreadth);\n\n        for (i = 0; i < n; ++i) {\n          node = nodes[i];\n          dy = y - node.y0;\n          if (dy > 0) node.y0 += dy, node.y1 += dy;\n          y = node.y1 + py;\n        } // If the bottommost node goes outside the bounds, push it back up.\n\n\n        dy = y - py - y1;\n\n        if (dy > 0) {\n          y = node.y0 -= dy, node.y1 -= dy; // Push any overlapping nodes back up.\n\n          for (i = n - 2; i >= 0; --i) {\n            node = nodes[i];\n            dy = node.y1 + py - y;\n            if (dy > 0) node.y0 -= dy, node.y1 -= dy;\n            y = node.y0;\n          }\n        }\n      });\n    }\n  }\n\n  function computeLinkBreadths(graph) {\n    graph.nodes.forEach(function (node) {\n      node.sourceLinks.sort(ascendingTargetBreadth);\n      node.targetLinks.sort(ascendingSourceBreadth);\n    });\n    graph.nodes.forEach(function (node) {\n      var y0 = node.y0,\n          y1 = y0;\n      node.sourceLinks.forEach(function (link) {\n        link.y0 = y0 + link.width / 2, y0 += link.width;\n      });\n      node.targetLinks.forEach(function (link) {\n        link.y1 = y1 + link.width / 2, y1 += link.width;\n      });\n    });\n  }\n\n  return sankey;\n}","map":{"version":3,"sources":["C:/Users/thero/OneDrive/Documents/factory-management/factory-management/factory-managment-frontend/node_modules/d3-sankey/src/sankey.js"],"names":["ascending","min","sum","map","nest","justify","constant","ascendingSourceBreadth","a","b","ascendingBreadth","source","index","ascendingTargetBreadth","target","y0","value","d","nodeCenter","node","y1","weightedSource","link","weightedTarget","defaultId","defaultNodes","graph","nodes","defaultLinks","links","find","nodeById","id","get","Error","x0","x1","dx","py","align","iterations","sankey","apply","arguments","computeNodeLinks","computeNodeValues","computeNodeDepths","computeNodeBreadths","computeLinkBreadths","update","nodeId","_","length","nodeAlign","nodeWidth","nodePadding","size","extent","forEach","i","sourceLinks","targetLinks","push","Math","max","next","x","depth","indexOf","height","kx","floor","call","columns","key","sortKeys","entries","values","initializeNodeBreadth","resolveCollisions","alpha","n","relaxRightToLeft","relaxLeftToRight","ky","width","dy","slice","reverse","y","sort"],"mappings":"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","sourcesContent":["import {ascending, min, sum} from \"d3-array\";\nimport {map, nest} from \"d3-collection\";\nimport {justify} from \"./align\";\nimport constant from \"./constant\";\n\nfunction ascendingSourceBreadth(a, b) {\n  return ascendingBreadth(a.source, b.source) || a.index - b.index;\n}\n\nfunction ascendingTargetBreadth(a, b) {\n  return ascendingBreadth(a.target, b.target) || a.index - b.index;\n}\n\nfunction ascendingBreadth(a, b) {\n  return a.y0 - b.y0;\n}\n\nfunction value(d) {\n  return d.value;\n}\n\nfunction nodeCenter(node) {\n  return (node.y0 + node.y1) / 2;\n}\n\nfunction weightedSource(link) {\n  return nodeCenter(link.source) * link.value;\n}\n\nfunction weightedTarget(link) {\n  return nodeCenter(link.target) * link.value;\n}\n\nfunction defaultId(d) {\n  return d.index;\n}\n\nfunction defaultNodes(graph) {\n  return graph.nodes;\n}\n\nfunction defaultLinks(graph) {\n  return graph.links;\n}\n\nfunction find(nodeById, id) {\n  var node = nodeById.get(id);\n  if (!node) throw new Error(\"missing: \" + id);\n  return node;\n}\n\nexport default function() {\n  var x0 = 0, y0 = 0, x1 = 1, y1 = 1, // extent\n      dx = 24, // nodeWidth\n      py = 8, // nodePadding\n      id = defaultId,\n      align = justify,\n      nodes = defaultNodes,\n      links = defaultLinks,\n      iterations = 32;\n\n  function sankey() {\n    var graph = {nodes: nodes.apply(null, arguments), links: links.apply(null, arguments)};\n    computeNodeLinks(graph);\n    computeNodeValues(graph);\n    computeNodeDepths(graph);\n    computeNodeBreadths(graph, iterations);\n    computeLinkBreadths(graph);\n    return graph;\n  }\n\n  sankey.update = function(graph) {\n    computeLinkBreadths(graph);\n    return graph;\n  };\n\n  sankey.nodeId = function(_) {\n    return arguments.length ? (id = typeof _ === \"function\" ? _ : constant(_), sankey) : id;\n  };\n\n  sankey.nodeAlign = function(_) {\n    return arguments.length ? (align = typeof _ === \"function\" ? _ : constant(_), sankey) : align;\n  };\n\n  sankey.nodeWidth = function(_) {\n    return arguments.length ? (dx = +_, sankey) : dx;\n  };\n\n  sankey.nodePadding = function(_) {\n    return arguments.length ? (py = +_, sankey) : py;\n  };\n\n  sankey.nodes = function(_) {\n    return arguments.length ? (nodes = typeof _ === \"function\" ? _ : constant(_), sankey) : nodes;\n  };\n\n  sankey.links = function(_) {\n    return arguments.length ? (links = typeof _ === \"function\" ? _ : constant(_), sankey) : links;\n  };\n\n  sankey.size = function(_) {\n    return arguments.length ? (x0 = y0 = 0, x1 = +_[0], y1 = +_[1], sankey) : [x1 - x0, y1 - y0];\n  };\n\n  sankey.extent = function(_) {\n    return arguments.length ? (x0 = +_[0][0], x1 = +_[1][0], y0 = +_[0][1], y1 = +_[1][1], sankey) : [[x0, y0], [x1, y1]];\n  };\n\n  sankey.iterations = function(_) {\n    return arguments.length ? (iterations = +_, sankey) : iterations;\n  };\n\n  // Populate the sourceLinks and targetLinks for each node.\n  // Also, if the source and target are not objects, assume they are indices.\n  function computeNodeLinks(graph) {\n    graph.nodes.forEach(function(node, i) {\n      node.index = i;\n      node.sourceLinks = [];\n      node.targetLinks = [];\n    });\n    var nodeById = map(graph.nodes, id);\n    graph.links.forEach(function(link, i) {\n      link.index = i;\n      var source = link.source, target = link.target;\n      if (typeof source !== \"object\") source = link.source = find(nodeById, source);\n      if (typeof target !== \"object\") target = link.target = find(nodeById, target);\n      source.sourceLinks.push(link);\n      target.targetLinks.push(link);\n    });\n  }\n\n  // Compute the value (size) of each node by summing the associated links.\n  function computeNodeValues(graph) {\n    graph.nodes.forEach(function(node) {\n      node.value = Math.max(\n        sum(node.sourceLinks, value),\n        sum(node.targetLinks, value)\n      );\n    });\n  }\n\n  // Iteratively assign the depth (x-position) for each node.\n  // Nodes are assigned the maximum depth of incoming neighbors plus one;\n  // nodes with no incoming links are assigned depth zero, while\n  // nodes with no outgoing links are assigned the maximum depth.\n  function computeNodeDepths(graph) {\n    var nodes, next, x;\n\n    for (nodes = graph.nodes, next = [], x = 0; nodes.length; ++x, nodes = next, next = []) {\n      nodes.forEach(function(node) {\n        node.depth = x;\n        node.sourceLinks.forEach(function(link) {\n          if (next.indexOf(link.target) < 0) {\n            next.push(link.target);\n          }\n        });\n      });\n    }\n\n    for (nodes = graph.nodes, next = [], x = 0; nodes.length; ++x, nodes = next, next = []) {\n      nodes.forEach(function(node) {\n        node.height = x;\n        node.targetLinks.forEach(function(link) {\n          if (next.indexOf(link.source) < 0) {\n            next.push(link.source);\n          }\n        });\n      });\n    }\n\n    var kx = (x1 - x0 - dx) / (x - 1);\n    graph.nodes.forEach(function(node) {\n      node.x1 = (node.x0 = x0 + Math.max(0, Math.min(x - 1, Math.floor(align.call(null, node, x)))) * kx) + dx;\n    });\n  }\n\n  function computeNodeBreadths(graph) {\n    var columns = nest()\n        .key(function(d) { return d.x0; })\n        .sortKeys(ascending)\n        .entries(graph.nodes)\n        .map(function(d) { return d.values; });\n\n    //\n    initializeNodeBreadth();\n    resolveCollisions();\n    for (var alpha = 1, n = iterations; n > 0; --n) {\n      relaxRightToLeft(alpha *= 0.99);\n      resolveCollisions();\n      relaxLeftToRight(alpha);\n      resolveCollisions();\n    }\n\n    function initializeNodeBreadth() {\n      var ky = min(columns, function(nodes) {\n        return (y1 - y0 - (nodes.length - 1) * py) / sum(nodes, value);\n      });\n\n      columns.forEach(function(nodes) {\n        nodes.forEach(function(node, i) {\n          node.y1 = (node.y0 = i) + node.value * ky;\n        });\n      });\n\n      graph.links.forEach(function(link) {\n        link.width = link.value * ky;\n      });\n    }\n\n    function relaxLeftToRight(alpha) {\n      columns.forEach(function(nodes) {\n        nodes.forEach(function(node) {\n          if (node.targetLinks.length) {\n            var dy = (sum(node.targetLinks, weightedSource) / sum(node.targetLinks, value) - nodeCenter(node)) * alpha;\n            node.y0 += dy, node.y1 += dy;\n          }\n        });\n      });\n    }\n\n    function relaxRightToLeft(alpha) {\n      columns.slice().reverse().forEach(function(nodes) {\n        nodes.forEach(function(node) {\n          if (node.sourceLinks.length) {\n            var dy = (sum(node.sourceLinks, weightedTarget) / sum(node.sourceLinks, value) - nodeCenter(node)) * alpha;\n            node.y0 += dy, node.y1 += dy;\n          }\n        });\n      });\n    }\n\n    function resolveCollisions() {\n      columns.forEach(function(nodes) {\n        var node,\n            dy,\n            y = y0,\n            n = nodes.length,\n            i;\n\n        // Push any overlapping nodes down.\n        nodes.sort(ascendingBreadth);\n        for (i = 0; i < n; ++i) {\n          node = nodes[i];\n          dy = y - node.y0;\n          if (dy > 0) node.y0 += dy, node.y1 += dy;\n          y = node.y1 + py;\n        }\n\n        // If the bottommost node goes outside the bounds, push it back up.\n        dy = y - py - y1;\n        if (dy > 0) {\n          y = (node.y0 -= dy), node.y1 -= dy;\n\n          // Push any overlapping nodes back up.\n          for (i = n - 2; i >= 0; --i) {\n            node = nodes[i];\n            dy = node.y1 + py - y;\n            if (dy > 0) node.y0 -= dy, node.y1 -= dy;\n            y = node.y0;\n          }\n        }\n      });\n    }\n  }\n\n  function computeLinkBreadths(graph) {\n    graph.nodes.forEach(function(node) {\n      node.sourceLinks.sort(ascendingTargetBreadth);\n      node.targetLinks.sort(ascendingSourceBreadth);\n    });\n    graph.nodes.forEach(function(node) {\n      var y0 = node.y0, y1 = y0;\n      node.sourceLinks.forEach(function(link) {\n        link.y0 = y0 + link.width / 2, y0 += link.width;\n      });\n      node.targetLinks.forEach(function(link) {\n        link.y1 = y1 + link.width / 2, y1 += link.width;\n      });\n    });\n  }\n\n  return sankey;\n}\n"]},"metadata":{},"sourceType":"module"}